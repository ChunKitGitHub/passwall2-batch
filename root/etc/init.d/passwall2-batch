#!/bin/sh /etc/rc.common
# Passwall2 批量导入工具 - 独立 Web 服务

START=99
STOP=10
USE_PROCD=1

start_service() {
    # 修复权限
    chmod 644 /www/passwall2-batch/index.html 2>/dev/null
    chmod 755 /www/passwall2-batch/api.cgi 2>/dev/null
    chmod 755 /www/passwall2-batch/cgi-bin/* 2>/dev/null

    procd_open_instance
    procd_set_param command /usr/sbin/uhttpd
    procd_append_param command -f
    procd_append_param command -h /www/passwall2-batch
    procd_append_param command -p 0.0.0.0:8099
    procd_append_param command -I index.html
    procd_append_param command -x /cgi-bin
    procd_set_param respawn
    procd_close_instance
}
